<html>
    <head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href = "styles/styles.css"/>
        <link href="https://fonts.googleapis.com/css?family=Montserrat|Staatliches|Roboto" rel="stylesheet">
        <script src="scripts/jquery-3.3.1.js"></script>
    </head>
    <body style="background-color: black;" >
        <div style = "height:100%; width: 100%;">
            <div id = "whole" class = "container-fluid background-slider-right" style = "height:100%;">
                <div id = "intro" class = "row header-font" style = "position: relative; margin:0px; height:100%;">
                    <div class = "col-md-6" style = "height:100%;">
                        <div id = "left-half" class = "row flex-center" style = "height:100%;">
                            <div id = "A" class = "col-lg-6 fade-in" style = "text-align:center;">
                                <span style = "font-size: 19rem; color:white;">A</span>
                            </div>
                            <div id = "J" class = "col-lg-6 fade-in" style = "text-align:center;">
                                <span style = "font-size: 19rem; color:white;">J</span>
                            </div>
                        </div>
                    </div>
                    <div class = "col-lg-6">
                        <div id = "right-half" class = "row flex-center" style = "height:100%;">
                            <div id = "A2" class = "col-lg-6 fade-in" style = "text-align:center;">
                                <span style = "font-size: 19rem;" class = "varsity-red" >A</span>
                            </div>
                            <div id = "I" class = "col-lg-6 fade-in" style = "text-align:center;">
                                <span style = "font-size: 19rem;" class = "varsity-red">I</span>
                            </div>
                        </div>
                    </div>
                </div>
                    <div id = "upload" class="row-overlay hide">
                        <div class = "box" data-text-before = "2">
                                    <div class="box__input">
                                      
                                        <label style = "" id = "upload-text" class = "varsity-red" for="file">
                                            <span id = "upload-label" class = "box__dragndrop" 
                                            style = "justify-content: center;
                                            align-items: center; text-align: center">
                                            Drag an image in or click to upload</span>
                                            
                                        </label>
                                        <button class="box__button" type="submit">Upload</button>
                                    </div>
                                    <div id = "box__uploading" class="box__uploading">
                                        <div id = "loader" class = "loader hide"></div>

                                    </div>
                                    <div class="box__success" style = "z-index:99;">
                                        <div class = "box__result-peripheral-fade box__success-top-text hide">
                                            SUCCESS! YOUR PICTURE IS (PROBABLY) AN AIR JORDAN 1!
                                        </div>

                                        <svg id="success" class ="success-color box__result-picture-fade hide" style="enable-background:new 0 0 50 50; width:100%;" 
                                        version="1.1" 
                                        viewBox="0 0 50 50" 
                                        xml:space="preserve"
                                        xmlns="http://www.w3.org/2000/svg" 
                                        xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <g id="Layer_1_1_">
                                            <polygon points="47.293,6.94 14,40.232 2.707,28.94 1.293,30.353 14,43.06 48.707,8.353  "/>
                                        </g></svg>
                                        <button class = "box__result-peripheral-fade box__success-button b hide">USE ANOTHER PICTURE</button>
                                    </div>
                                    <div class="box__failure">
                                        <div class = "box__result-peripheral-fade box__failure-top-text hide" >
                                            SORRY! YOUR PICTURE IS (PROBABLY) NOT AN AIR JORDAN 1.
                                        </div>
                                        <svg id="failure" class = "box__result-picture-fade hide" style="enable-background:new 0 0 139 139; width:100%; height:300px;" version="1.1" viewBox="0 0 139 139" xml:space="preserve" 
                                        xmlns="http://www.w3.org/2000/svg" 
                                        xmlns:xlink="http://www.w3.org/1999/xlink">
                                            <style type="text/css">
                                                .st0{fill:none;stroke-width:6;stroke-miterlimit:10;}
                                                .st1{display:none;fill:none;stroke-width:6;stroke-miterlimit:10;}
                                                .st2{display:none;}
                                            </style>
                                            <line class="st0 cancel-color" id="failure_x1" x1="100" x2="39" y1="38.6" y2="99.6"/>
                                            <line class="st0 cancel-color" id="failure_x3" x1="100" x2="39" y1="99.6" y2="38.6"/>
                                            <line class="st1 cancel-color" id="failure_x2" x1="56.8" x2="69.5" y1="94.2" y2="111.2"/>
                                            <line class="st1" id="XMLID_21_" x1="69.5" x2="82.2" y1="111.2" y2="94.2"/>
                                            <rect class="st2" height="1.4" id="XMLID_23_" width="4.8" x="67.1" y="111.6"/>
                                        </svg>
                                        <button id = "box__failure-button" class = "box__result-peripheral-fade box__failure-button b hide">USE ANOTHER PICTURE</button>

                                    </div>
                                    <div class="box__error hide">Error! <span></span>.</div>
                                    <input type = "hidden" name = "ajx" value = "1"/>
                        </div>
                        <div style = "position:absolute; width : 50%; height: 65%;">
                                <form style = "height:100%;" class="" id = "form" method="post" action="" novalidate enctype="multipart/form-data">
                                      <input class="box__file box-form" type="file" name="files[]" id="file" data-multiple-caption="{count} files selected" multiple />
                                  </form>

                        </div>
                    </div>
            </div>

            <!--
            <div class ="container" style = "position: relative; top:80px; height:80%; width:70%; border-left: 3px; border-right:3px;
             border-color: red; border-style: solid;">
                <h1 style = "color:white; text-align:center;
                ">Air Jordan 1</h1>
                
            </div>
            -->
        </div>

    </body>
    <script>
        var timeout = 700;
        var isAdvancedUpload = function() {
            var div = document.createElement('div');
            return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window; 
        }();
        console.log('is advanced upload: ' + isAdvancedUpload);
        var $form = $('#form');
        var $label = $('#upload-text');
        var showFiles = function(files) {
            console.log($label);
            console.log(files.name);
            $label.text(files.length > 1 ? ($input.attr('data-multiple-caption') || '').replace('{count}', files.length) : files.name);
        };
        var uploadText = document.getElementById('upload-text');
        var droppedFiles = false;
        if (isAdvancedUpload) {
            uploadText.innerHTML = 'Drag an image, or click to upload.';
            console.log('is advancedupload');
            $form.addClass('has-advanced-upload');
            $form.on('drag dragstart dragend dragover dragenter dragleave drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('drag');
            })
            .on('dragover dragenter', function(e) {
                e.preventDefault();
                e.stopPropagation();
                $form.addClass('is-dragover');
                console.log('dragover');
            })
            .on('dragleave dragend drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                $form.removeClass('is-dragover');
                console.log('dragleave');
            })
            .on('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                droppedFiles = e.originalEvent.dataTransfer.files;
                console.log(e.originalEvent.dataTransfer);
                console.log(droppedFiles);
                showFiles(...droppedFiles);
                console.log('drop');

                $form.trigger('submit');
            });

        }
        $form.on('submit', function(e) {
            if ($form.hasClass('is-uploading')) {
                return false;
            }
            $('#upload-text').addClass('hide');
            $form.addClass('is-uploading').removeClass('is-error');
            $label.addClass('hide');
            $('.box').addClass('hide-before');
            $('.box').addClass('hide-after');
            $('.loader').removeClass('hide');
            $('#box__uploading').removeClass('box__uploading');

            setTimeout(function() {
                $('#loader').addClass('active');
                
            }, 500);
            //TODO: animate hiding of box
            console.log('on submit');
            if(isAdvancedUpload) {
                e.preventDefault();
                e.stopPropagation();
                console.log('here');
                var url = "http://localhost:5000/predict";
                var formData = new FormData($form.get(0));
                if (droppedFiles) {
                    formData.append('image',droppedFiles[0]);
                    console.log('dropped files: ' + JSON.stringify(formData));
                    console.log(droppedFiles[0]);
                    $.ajax({
                        'url': url,
                        type: 'POST',
                        data: formData,
                        crossDomain: true,
                        xhrFields: {
                            withCredentials: false
                        },
                        success: function(response, textStatus, jqXHR) {
                            console.log(textStatus);
                            console.log('data: ' +  JSON.stringify(response));
                            setTimeout(function() {
                                $('#loader').removeClass('active') 
                                setTimeout(function() {
                                    showResult(response);

                                }, 500)
                            }, 1500);
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            console.log(errorThrown);
                        },
                        processData: false,
                        contentType: false
                    });
                }
            } else {
                e.preventDefault();
                e.stopPropagation();

            }
        });
        function showResult(response) {
            $('#box__uploading').addClass('box__uploading');
            var success = response['success'];
            $('.loader').addClass('hide');
             
            if (success) {
                $('.box__success').css('display', 'block');
                $('#failure').css('display', 'none');
                $('#success').removeClass('hide');
                $('.box__success-button').removeClass('hide');
                $('.box__success-top-text').removeClass('hide');
                setTimeout(function() {
                    $('#success').addClass('active');
                    $('.box__success-top-text').addClass('active');
                    $('.box__success-button').addClass('active');
                    
                }, 300);
            } else {
                $('.box__failure').css('display', 'block');
                $('#success').css('display', 'none');
                $('#failure').removeClass('hide');
                $('.box__failure-button').removeClass('hide');
                $('.box__failure-top-text').removeClass('hide');
                setTimeout(function() {
                    $('#failure').addClass('active');
                    $('.box__failure-top-text').addClass('active');
                    $('#box__failure-button').addClass('active');
                    

                }, 300);
                
            }
        }
        $('.box__success-button, .box__failure-button').on('click', function() {
            console.log('CLICK');
            var selector = '.box__success';
            var success = '#success'; 
            console.log($(this));
            if($(this).hasClass('box__failure-button')) {
                selector = '.box__failure';
                success = '#failure';
            }
            $(this).removeClass('active');
            $(selector + '-top-text').removeClass('active');
            $(success).removeClass('active');
            var that = this;
            setTimeout(function () {
                $(that).addClass('hide');
                $(selector + '-top-text').addClass('hide');
                $(success).addClass('hide');
                var intro = document.getElementById('intro');
                var upload = document.getElementById('upload');
                 
                $(intro).removeClass('hide');
                whole.classList.add('active');
                setTimeout(function() {
                    whole.classList.add('active2'); 
                    setTimeout(function() {
                        whole.classList.remove('active2'); 
                        whole.classList.remove('active'); 
                        setTimeout(function() {
                            intro.classList.add('hide');
                            setTimeout(function() {
                                upload.classList.remove('hide');
                                upload.classList.add('animate-upload');
                                $('#upload-text').removeClass('hide');
                                $form.addClass('is-uploading').addClass('is-error');
                                $label.text = 'Drag an image in or click to upload';
                                $label.removeClass('hide');
                                $('.box').removeClass('hide-before');
                                $('.box').removeClass('hide-after');
                            });
                        }, 500);
                    }, 700);
                }, 200);

            }, 2000);

            //$(selector).css('display', 'none');
        });
        window.onload = function() {
            var whole = document.getElementById('whole'); 
            var left = document.getElementById('left-half');
            var right = document.getElementById('right-half');
            var a = document.getElementById('A');
            var j = document.getElementById('J');
            var a2 = document.getElementById('A2');
            var i = document.getElementById('I');
            var intro = document.getElementById('intro');
            var upload = document.getElementById('upload');
            a.classList.add('active');
            setTimeout(function() {
                j.classList.add('active');
                setTimeout(function(){
                    a.classList.remove('active');
                    a2.classList.add('active');
                    setTimeout(function() {
                        i.classList.add('active');
                        j.classList.remove('active');
                        setTimeout(function() { 
                            //a2.classList.remove('active');
                            left.classList.add('active');
                            right.classList.add('active');
                            whole.classList.add('active');
                            setTimeout(function() {
                                whole.classList.add('active2'); 
                                //i.classList.remove('active');
                                //whole.classList.add('active2'); 
                                setTimeout(function() {
                                   whole.classList.remove('active2'); 
                                   whole.classList.remove('active'); 
                                   setTimeout(function() {
                                    i.classList.add('hide');
                                    a2.classList.add('hide');
                                    setTimeout(function() {
                                        intro.classList.add('hide');
                                        setTimeout(function() {
                                            upload.classList.remove('hide');
                                            upload.classList.add('animate-upload');
                                            $form = $('#form');
                                            $label = $('#upload-text');
                                        })
                                    }, 500);
                                   }, 100);
                                }, timeout);

                            }, 200);
                        }, timeout);

                    }, timeout);
                }, timeout);
            }, timeout);
            
            
        }
    </script>
</html>